<%
    console.log("messageList: ",messageList);
%>
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <link rel="stylesheet" href="/static/css/default.css" />
    <link rel="stylesheet" href="/static/css/all.css" />
    <link rel="stylesheet" href="/static/css/swiper.css" />
    <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css"/>
    <link rel="stylesheet" href="/static/css/style.css" />
    <link rel="stylesheet" href="/static/css/index.css" />
    <link rel="stylesheet" href="/static/css/responsible.css" />
    <!-- <link rel="stylesheet" href="slick/slick.css" /> -->
    <link rel="stylesheet" href="/static/slick/slick-theme.css" />
    <link rel="stylesheet" href="/static/xeicon/xeicon.css">
    <link rel="stylesheet" href="https://unpkg.com/aos@2.3.1/dist/aos.css"> 
	<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script> 
    <!-- <script src="js/jquery-2.2.4.min.js"></script> -->
    <!-- <script src="../js/validate.js"></script> -->
    <script src="/static/js/swiper.min.js"></script>
    <!-- <script src="js/frontEvent.js"></script> -->
    <!-- <script src="/static/slick/slick.js"></script> -->
    <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/i18next/1.9.0/i18next.min.js" type="text/javascript"></script>
    <script src="/static/js/textFile.js"></script>
</head>
<style>
    /* body{background-color: red;} */
</style>
<body>
    <!-- <div class="modal modal2">
        <div class="costomAlert">
            <h3></h3>
            <div class="btnWrap">
                <button class="closeBtn">í™•ì¸</button>
            </div>
        </div>
    </div> -->
    <div class="wrap signGage" style="position: relative;">
        <div class="headerWrap">
            <!-- <div class="stepGage">
                <div class="inGage"></div>
            </div> -->
        </div>
        
        <section class="marginCenter signUpWrap mainWrap">
            <div class="tab mainStep block">
                <div class="titleWrap">
                    <h2><span class="ownerNickname">OO</span>ë‹˜ì˜ ìƒˆí•´ìƒ</h2>
                    <h3>âœ‰ï¸ <span class="totalNum"></span>ê°œì˜ ì—°í•˜ì¥ì´ ë„ì°©í–ˆì–´ìš”!</h3>
                </div>
                <div class="mainImage">
                    <img src="/static/img/mainImage.png" alt="">
                    <!-- ë©”ì‹œì§€ê°€ ìƒê¸´ ê²½ìš° -->
                    <div class="messageContent">
                    <% 
                        for ( var i = 0; i < messageList.length; i++)
                        { 
                            let disclosure = disclosureStatus;
                    %>
                        <!-- <h4><%=messageList[i].type%></h4> -->
                        <div class="messageClick <%-messageList[i].messageId%>">
                            <img class="imgClass<%-messageList[i].type%>" src="/static/img/i<%-messageList[i].type%>.png" alt="">
                            <!-- <div class="<%-messageList[i].writer%>">
                                <%-messageList[i].writer%>
                            </div> -->

                            <div class="writeFormModal none" style="position: fixed;top: 40px;bottom: 40px;margin: auto;z-index: 999;">
                                <div class="choiced">
                                    <img src="/static/img/i<%-messageList[i].type%>.png" style="display: block;top: -11px;" alt="">
                                </div>
                                <h3>From.<%-messageList[i].writer%></h3>
                                <!-- <h2>testUser</h2> -->
                                <%
                                    if(!messageList[i].exposure || !disclosure)
                                    {
                                %>
                                        <p class="secretMessage"><%-messageList[i].message%></p>
                                <%
                                    }
                                    else
                                    {
                                %>
                                        <p class="textMessage"><%-messageList[i].message%></p>
                                <%
                                    }
                                %>
                                <button class="btnDefault" style="position:absolute;bottom:20px;left: 0;right: 0;margin: auto;">ë‹«ê¸°</button>
                            </div>
                        </div>
                    <% 
                        } 
                    %>
                    </div> 
                    
                </div>
                <div class="pageNum">
                    <a href=""><<</a><span class="currentNum">1</span>/<span class="allNum">1</span><a href="">>></a>
                </div>
                <div class="submitBtn linkCopy invite none">
                    <button onclick="copyUrl()">ë‚´ ìƒˆí•´ìƒ ë§í¬ ë³µì‚¬í•˜ê¸°</button>
                </div>
                <div class="submitBtn linkCopy beforeInvite none">
                    <button class="decorate">ìƒˆí•´ìƒ ê¾¸ë©°ì£¼ê¸°</button>
                    <button class="create createNewDesk">ë‚˜ë„ ìƒˆí•´ìƒ ë§Œë“¤ê¸°</button>
                </div> 
                
            </div>
            <div class="tab choiceStep">
                <div class="stepGage">
                    <div class="inGage"></div>
                </div>
                <div class="titleWrap">
                    <h2>
                        ìƒˆí•´ìƒ ìŒì‹ì„ 
                        <br>ê³¨ë¼ì£¼ì„¸ìš”!
                    </h2>
                </div>
                <div class="foodChoice">
                        <div class="checks">
                            <input type="radio" id="i1" name="food" value="1"> 
                            <label for="i1">
                                <div class="image">
                                    <img src="/static/img/i1.png" alt="">
                                </div>
                                
                            </label> 
                        </div>
                        <div class="checks">
                            <input type="radio" id="i2" name="food" value="2"> 
                            <label for="i2">
                                <div class="image">
                                    <img src="/static/img/i2.png" alt="">
                                </div>
                            </label> 
                        </div>
                        <div class="checks">
                            <input type="radio" id="i3" name="food" value="3"> 
                            <label for="i3">
                                <div class="image">
                                    <img src="/static/img/i3.png" alt="">
                                </div>
                            </label> 
                        </div>
                        <div class="checks">
                            <input type="radio" id="i4" name="food" value="4"> 
                            <label for="i4">
                                <div class="image">
                                    <img src="/static/img/i4.png" alt="">
                                </div>
                            </label> 
                        </div>
                        <div class="checks">
                            <input type="radio" id="i5" name="food" value="5"> 
                            <label for="i5">
                                <div class="image">
                                    <img src="/static/img/i5.png" alt="">
                                </div>
                            </label> 
                        </div>
                        <div class="checks">
                            <input type="radio" id="i6" name="food" value="6"> 
                            <label for="i6">
                                <div class="image">
                                    <img src="/static/img/i6.png" alt="">
                                </div>
                            </label> 
                        </div> 
                    
                </div>
                <div class="submitBtn completeArea">
                    <button class="prev">ì´ì „</button>
                    <button class="next">ë‹¤ìŒ</button>
                </div>
            </div>

            <div class="tab writeStep">
                <div class="stepGage active">
                    <div class="inGage"></div>
                </div>
                <div class="titleWrap">
                    <h2>
                        <span class="ownerNickname">OO</span>ë‹˜ì—ê²Œ
                        <br>
                        ì—°í•˜ì¥ì„ ë‚¨ê²¨ì£¼ì„¸ìš”
                    </h2>
                </div>
                <div class="writeForm">
                    <div class="choiced">
                        <img src="" alt="">
                        <!-- <img src="/static/img/i2.png" alt="">
                        <img src="/static/img/i3.png" alt="">
                        <img src="/static/img/i4.png" alt="">
                        <img src="/static/img/i5.png" alt="">
                        <img src="/static/img/i6.png" alt=""> -->
                    </div>
                    <h3>From.</h3>
                    <input type="text" id="nickName" placeholder="ë‹‰ë„¤ì„ (ìµœëŒ€8ì)" maxlength='8'>
                    <textarea name="" id="writeContent" cols="30" rows="10" placeholder="ì¶”ì–µì— ë‚¨ëŠ” ì—°í•˜ì¥ì„ ë‚¨ê²¨ì£¼ì„¸ìš”"></textarea>
                </div>
                <div class="publicWrap">
                    <label for="public" class="chk_box">
                        <input type="checkbox" id="public" />
                        <span class="on"></span>
                        ì—°í•˜ì¥ ì£¼ì¸ì—ê²Œë§Œ ë³´ì—¬ì¤„ë˜ìš”(ë¹„ê³µê°œ)
                    </label>
                </div>
                <div class="submitBtn completeArea line">
                    <button class="prev">ì´ì „</button>
                    <button class="next">ì™„ë£Œ</button>
                </div>
            </div>
        </section>
        
    <!-- ëª¨ë°”ì¼ ë„¤ë¹„ê²Œì´ì…˜ -->
    </div>
    <script>
        let savedToken = localStorage.getItem("accessToken");
        let ownerNickname = "<%=ownerNickname%>";
        let ownerUid = "<%=owner%>";
        let nowUrl = window.location.href;
        let totalCount = "<%=total%>";
        function copyUrl(){ 
        //nowUrl ë³€ìˆ˜ì— ë‹´ê¸´ ì£¼ì†Œë¥¼
            navigator.clipboard.writeText(nowUrl).then(res=>{
            alert("ì£¼ì†Œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!");
            })
        }

        

        $(function()
        {
            
            // ë‹‰ë„¤ì„ ì„¤ì •
            if(ownerNickname === "")
            {
                $(".ownerNickname").html("ìµëª…")
            }
            else
            {
                $(".ownerNickname").html(ownerNickname)
            }

            // í•´ë‹¹ uid ë©”ì‹œì§€ ì´ê°œìˆ˜
            $(".totalNum").html(totalCount);

            $(".btnDefault").on("click",function()
                {
                    // $(this).parents(".writeForm").fadeOut()
                    $(this).parents(".writeFormModal").addClass("none")
                    // $(".messageClick>.writeForm").fadeOut()
                    // console.log(287364827)
                    // $(".messageClick>.writeForm").fadeOut
                    // $(".writeForm").toggleClass("none")
                    // if($(this).parent(".writeForm").hasClass("none") === false)
                    // {
                    //     $(".writeForm").addClass("none")
                    // }
                }
            )

            $(".messageClick>img").on("click",function()
                {
                    // $(this).children(".writeFormModal").css({"display":"block"})
                    // $(this).children(".writeForm").toggleClass("none")
                    $(this).siblings(".writeFormModal").removeClass("none")

                    // if($(this).children(".writeForm").hasClass("none"))
                    // {
                    //     $(this).children(".writeForm").removeClass("none")
                    // }
                    // else{
                        
                    // }
                }
            )

            
            
            if(savedToken)
            {
                let jsonData = {};
                jsonData.accessToken = savedToken;
                
                $.ajax({
                    type: 'post',
                    url: '/user/verifyToken',
                    data : jsonData,
                    dataType : 'json',
                    success: function(res) {
                        console.log(res);
                        if(res.uid == ownerUid)
                        {
                            console.log("ë³¸ì¸ì˜ ì—°í•˜ì¥");
                            $(".invite").removeClass("none");
                        }
                        else
                        {
                            console.log("ì´ˆëŒ€ë°›ì€ ì—°í•˜ì¥");
                            $(".beforeInvite").removeClass("none");
                            $(".invite").addClass("none");
                            $(".createNewDesk").addClass("none");
                            $(".secretMessage").html("ğŸ”");
                        }
                    },
                    error: function(err) {
                        // localStorageì—ì„œ accessTokenì„ ì§€ìš°ê³  ë©”ì¸ í™”ë©´ìœ¼ë¡œ ì´ë™
                        localStorage.removeItem('accessToken');
                        location.href = '/';
                    }
                })
            }
            else
            {
                console.log("ì´ˆëŒ€ë°›ì€ ì—°í•˜ì¥");
                $(".invite").addClass("none");
                $(".beforeInvite").removeClass("none");
                $(".createNewDesk").removeClass("none");
                $(".secretMessage").html("ğŸ”");
            }


            ///////////////////////////indexSubLink////////////////////////////////
            // ìƒˆí•´ìƒ ê¾¸ë©°ì£¼ê¸° ë²„íŠ¼ í´ë¦­ì‹œ
            $(".decorate").on("click",function()
                {
                    $(".mainStep").removeClass("block")
                    $(".choiceStep").addClass("block")
                }
            )
            
            // ìƒˆí•´ìƒ ìŒì‹ ì„ íƒ í´ë¦­
            $(".choiceStep .prev").on("click",function()
                {
                    $(".mainStep").addClass("block")
                    $(".choiceStep").removeClass("block")
                }
            )

            $(".choiceStep .next").on("click",function()
                {
                    var foodCheck = $("input[name='food']").is(":checked");
                    // scopeCheck = $.trim( scopeCheck );
                    if( foodCheck === false )
                    {
                        alert("ìŒì‹ì„ ì„ íƒí•´ì£¼ì„¸ìš”");
                        return; 
                    }  

                    $(".choiceStep").removeClass("block")
                    $(".writeStep").addClass("block")

                
                    //ì„ íƒí•œ ìƒˆí•´ ìŒì‹ ì—°í•˜ì¥í¼ì— ì¶œë ¥í•˜ê¸°
                    if($(".foodChoice .checks input[type='radio']").is(":checked"))
                    {
                        
                        let choicedFood = $(".foodChoice .checks input[type='radio']:checked").val()
                        
                        // $(".mainWrap .writeStep .writeForm .choiced").append('<img class="active" src="/static/img/i'+choicedFood+'.png">')
                        $(".writeForm .choiced img").attr("src", "/static/img/i"+choicedFood+".png").addClass("active")
                    }
                    
                    
                    
                }
            )

            
            
            // ì—°í•˜ì¥ í¼
            $(".writeStep .prev").on("click",function()
                {
                    $(".choiceStep").addClass("block")
                    $(".writeStep").removeClass("block")
                }
            )

            $(".writeStep .next").on("click",function()
                {
                    const URLSearch = new URLSearchParams(location.search);
                    var uidData = URLSearch.get("uid")
                    var foodType = $(".foodChoice .checks input[name='food']:checked").val();
                    var writer = $('.mainWrap .writeStep #nickName').val();
                    var message = $('.mainWrap .writeStep #writeContent').val();
                    var exposure = !($('input:checkbox[id=public]').is(':checked'));


                    let jsonData2 = {
                        uid:ownerUid,
                        type:foodType,
                        writer,
                        message,
                        exposure,
                    }

                    if( writer === "" )
                    {
                        alert("ë‹‰ë„¤ì„ì„ ì„¤ì •í•´ì£¼ì„¸ìš”");
                        return; 
                    }  
                    if( message === "" )
                    {
                        alert("ë©”ì‹œì§€ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”");
                        return; 
                    }  

                    // console.log(jsonData2)

                    $.ajax({
                            url : "/message",
                            type : "post",
                            data : jsonData2,
                            dataType : 'json',
                            success : function(response){
                                
                                console.log(response)
                                location.reload();
                                
                            },
                            error : function(err){
                                console.log(err,"ì—ëŸ¬")
                            }
                    })
                }
            )
            ///////////////////////////indexSubLink////////////////////////////////
        })
    </script>
</body>
</html>